{% extends "datasets.html" %}

{% block nav_links__secondary__extra %}
<li><a href="/data/{{ path }}/delete">Delete this dataset</a></li>
{% endblock %}

{% block content %}
<section class="dataset dataset--raw-gitstamp">
  <h2>Gitstamp</h2>
  {% if raw.gitstamp is defined %}
    <pre>{{ raw.gitstamp }}</pre>
  {% else %}
    <p style="error">Not found!</p>
  {% endif %}
</section>
<section class="dataset dataset--raw-recipe">
  <h2>Recipe</h2>
  {% if raw.recipe is defined %}
    <pre>{{ raw.recipe }}</pre>
  {% else %}
    <p style="error">Not found!</p>
  {% endif %}
</section>
{% if recipe is defined %}
  <section class="dataset dataset--recipe">
    <h2>Parsed recipe</h2>
    {% if recipe.populations is defined %}
      <h3>Populations</h3>
      <dl>
        {% for pop in recipe.populations %}
          <dt>Number</dt><dd>{{ pop.number }}</dd>
        {% endfor %}
      </dl>
    {% else %}
      <p class="error">Can't find any populations.</p>
    {% endif %}
  </section>
{% else %}
  <section class="dataset dataset--error">
    <h2>Recipe missing</h2>
    <p class="error">Cannot find any recipe data..</p>
  </section>
{% endif %}
{% if more_info is defined %}
    <section class="dataset dataset--raw-data">
        <h2>All entities</h2>
        <table>
          <tr><th>ID</th><th>Name</th><th>Population</th><th>Tier</th><th>Sourcing?</th><th>Mean ack time</th><th>Mean answer time</th><th>Mean routing time</th><th>Mean suppliers</th><th>Probability of not acknowledging</th></tr>
            {% for entity in more_info.entity %}
            <tr>
              <td>{{ entity.id }}</td>
              <td>{{ entity.name }}</td>
              <td>{{ entity.population }}</td>
              <td>{{ entity.tier }}</td>
              <td>{{ entity.is_sourcing ? 'sourcing' : 'normal' }}</td>
              <td>{{ entity.mean_ack_time }}</td>
              <td>{{ entity.mean_answer_time }}</td>
              <td>{{ entity.mean_routing_time }}</td>
              <td>{{ entity.mean_extra_suppliers + 1 }}</td>
              <td>{{ entity.probability_no_ack }}</td>
            </tr>
            {% endfor %}
            <tr class="aggregates">
                <td>Summary:</td>
                <td>{{ database.entities.count }}</td>
                <td>{{ database.populations.count }}</td>
                <td></td>
                <td></td>
                <td>{{ database.entities.mean_ack_time }}</td>
                <td>{{ database.entities.mean_answer_time }}</td>
                <td>{{ database.entities.mean_routing_time }}</td>
                <td>{{ database.entities.mean_extra_suppliers + 1 }}</td>
                <td>{{ database.entities.probability_no_ack }}</td>
            </tr>
        </table>

        <h2>Questions</h2>
        <ul>
          <li>Number: {{ database.questions.count }}</li>
          <li>Number of asks: {{ database.questions.asks.count }}</li>
        </ul>
    </section>
{% else %}
    <section class="dataset dataset--error">
        <h2>Entities not found</h2>
        <p class="error">No entities found; the database file could be missing or misnamed?</p>
    </section>
{% endif %}

{% endblock %}
