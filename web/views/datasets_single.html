{% extends "datasets.html" %}

{% block nav_links__secondary__extra %}
<li><a href="/data/{{ path }}/delete">Delete this dataset</a></li>
{% endblock %}

{% block content %}
<section class="dataset dataset--raw-gitstamp">
  <h2>Gitstamp</h2>
  {% if raw.gitstamp is defined %}
    <pre>{{ raw.gitstamp }}</pre>
  {% else %}
    <p style="error">Not found!</p>
  {% endif %}
</section>
<section class="dataset dataset--raw-recipe">
  <h2>Recipe</h2>
  {% if raw.recipe is defined %}
    <pre>{{ raw.recipe }}</pre>
  {% else %}
    <p style="error">Not found!</p>
  {% endif %}
</section>
{% if recipe is defined %}
  <section class="dataset dataset--recipe">
    <h2>Parsed recipe</h2>
    {% if recipe.populations is defined %}
      <h3>Populations</h3>
      <dl>
        {% for pop in recipe.populations %}
          <dt>Number</dt><dd>{{ pop.number }}</dd>
        {% endfor %}
      </dl>
    {% else %}
      <p class="error">Can't find any populations.</p>
    {% endif %}
  </section>
{% else %}
  <section class="dataset dataset--error">
    <h2>Recipe missing</h2>
    <p class="error">Cannot find any recipe data..</p>
  </section>
{% endif %}
{% if more_info is defined %}
    <section class="dataset dataset--raw-data">
        <h2>All entities</h2>
        <table>
          <thead>
            <tr>
              <th class="col-vthin">ID</th>
              <th>Name</th>
              <th>Population</th>
              <th class="col-thin">Tier</th>
              <th class="col-thin">Sourcing?</th>
              <th class="col-thin">ACK</th>
              <th class="col-thin">ANSWER</th>
              <th class="col-thin">ROUTING</th>
              <!-- <th>Self-time ratio</th> -->
              <th class="col-thin"># suppliers</th>
              <th class="col-thin">p(not acknowledging)</th>
              <th class="col-thin">p(not answering)</th></tr>
          </thead>
          <tbody>
            {% for entity in more_info.entity %}
            <tr>
              <td>{{ entity.id }}</td>
              <td>{{ entity.name }}</td>
              <td>{{ entity.population }}</td>
              <td>{{ entity.tier }}</td>
              <td>{{ entity.is_sourcing ? 'sourcing' : 'normal' }}</td>
              <td>{{ entity.mean_ack_time|number_format(2, '.', ',') }}</td>
              <td>{{ entity.mean_answer_time|number_format(2, '.', ',') }}</td>
              <td>{{ entity.mean_routing_time|number_format(2, '.', ',') }}</td>
              <!-- <td>{{ entity.self_time_ratio }}</td> -->
              <td>{{ entity.mean_extra_suppliers + 1 }}</td>
              <td>{{ entity.probability_no_ack }}</td>
              <td>{{ entity.probability_no_answer }}</td>
            </tr>
            {% endfor %}
          </tbody>
          <tfoot>
            <tr class="aggregates">
                <td>Summary:</td>
                <td>{{ database.entities.count }}</td>
                <td>{{ database.populations.count }}</td>
                <td></td>
                <td></td>
                <td>{{ database.entities.mean_ack_time|number_format(2, '.', ',') }}</td>
                <td>{{ database.entities.mean_answer_time|number_format(2, '.', ',') }}</td>
                <td>{{ database.entities.mean_routing_time|number_format(2, '.', ',') }}</td>
                <!-- <td></td> -->
                <td>{{ database.entities.mean_extra_suppliers + 1 }}</td>
                <td>{{ database.entities.probability_no_ack }}</td>
                <td>{{ database.entities.probability_no_answer }}</td>
            </tr>
          </tfoot>
        </table>

        <h2>Questions</h2>
        <ul>
          <li>Number: {{ database.questions.count }}</li>
          <li>Number of asks: {{ database.questions.asks.count }}</li>
        </ul>
    </section>
{% else %}
    <section class="dataset dataset--error">
        <h2>Entities not found</h2>
        <p class="error">No entities found; the database file could be missing or misnamed?</p>
    </section>
{% endif %}

{% endblock %}
